<style>

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

.tablinks_dataset_2{
    font-size: 11px;
    font-weight: bold;
    overflow-y: auto;
  }

.tablinks_dataset{
    font-size: 11px;
    font-weight: bold;
  }



tbody::-webkit-scrollbar {
    width: 1em;
}

tbody::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 4px rgba(0,0,0,0.3);
}

tbody::-webkit-scrollbar-thumb {
  background-color: darkgrey;
  outline: 0px solid slategrey;
}




.datasets-table {
  display: block;
  height: 100%;
  overflow-y: auto;
  border-collapse: collapse;
  table-layout: auto;
}

.datasets-table th, td{
padding: 4px;
  text-align: left;
  border-bottom: 0px solid #ddd;
}

.datasets-table tr.header{
	background-color:#B0B0B0
}

.datasets-table tr.header:hover{
	background-color:#B0B0B0
}

.datasets-table tr:hover{
	background-color:#f5f5f5;
}

/* Style the tab */
.tab_datasets {
  overflow: hidden;
  border: 0px solid #ccc;
  background-color: #f1f1f1;
  font-size: 12px;
}

/* Style the buttons that are used to open the tab content */

.tab_datasets button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 21px;
  transition: 0.3s;
}


/* Change background color of buttons on hover */
.tab_datasets button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab_datasets button.active {
  background-color: #ccc;
}



.tabcontent_dataset {
  display: none;
  border: 0px solid #ccc;
  border-top: none;
  height: calc(100% - 10%);
}


.pagination {
  display: inline-block;
  font-size: 12px;
}

.pagination a {
  color: black;
  float: left;
  padding: 5px 11px;
  text-decoration: none;
}

.pagination a.active {
  background-color: #4CAF50;
  color: white;
  border-radius: 3px;
}

.pagination a:hover:not(.active) {
  background-color: #ddd;
  border-radius: 3px;
}


.upload-btn-wrapper {
  position: relative;
  overflow: hidden;
  display: inline-block;
}

.btn_upload {
  border: 1px solid gray;
  color: black;
  background-color: #dbdbdb;
  padding: 5px 14px;
  border-radius: 5px;
  font-size: 14px;
  font-weight: bold;
}

.btn_upload button:hover{
	background-color: #fbfbfb;
}

.upload-btn-wrapper input[type=file] {
  font-size: 70px;
  position: absolute;
  left: 0;
  top: 0;
  opacity: 0;
}

.select-css {

    font-size: 10px;
    font-family: sans-serif;
    font-weight: 700;
    color: #444;
    line-height: 1.3;
    padding: .6em 1.4em .5em .8em;
    width: 20%;
    max-width: 20%;
    box-sizing: border-box;
    margin: 0;
    border: 0px solid #aaa;
    box-shadow: 0 0px 0 0px rgba(0,0,0,.04);
    border-radius: 11px;
    -moz-appearance: none;
    -webkit-appearance: none;
    appearance: none;
    background-color: #fff;
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'),
      linear-gradient(to bottom, #ffffff 0%,#e5e5e5 100%);
    background-repeat: no-repeat, repeat;
    background-position: right .7em top 50%, 0 0;
    background-size: .65em auto, 100%;
}
.select-css::-ms-expand {
    display: none;
}
.select-css:hover {
    border-color: #888;
}
.select-css:focus {
    border-color: #aaa;
    box-shadow: 0 0 0px 2px rgba(59, 153, 252, .7);
    box-shadow: 0 0 0 2px -moz-mac-focusring;
    color: #222;
    outline: none;
}
.select-css option {
    font-weight:normal;
}

input[type=text] {
  border: 0px;
  border-radius: 7px;
  border:0px solid #cccccc;
  outline: none;
  background:#f1f1f1;
}


</style>


<!--
<script src="../../static/js/datasets.js" type="text/javascript" charset="utf-8"></script>
-->


<script type="text/javascript">
		//stopping loader when the page is loaded
		$("#datasets_def").prop("class", "hide-loader")

		function openDivDashboard(evt, divName) {
		  // Declare all variables
		  var i, tabcontent, tablinks_dataset_2;

		  // Get all elements with class="tabcontent" and hide them
		  tabcontent = document.getElementsByClassName("tabcontent");
		  for (i = 0; i < tabcontent.length; i++) {
		    tabcontent[i].style.display = "none";
		  }

		  // Get all elements with class="tablinks" and remove the class "active"
		  tablinks_dataset_2 = document.getElementsByClassName("tablinks_dataset_2");
		  for (i = 0; i < tablinks_dataset_2.length; i++) {
		    tablinks_dataset_2[i].className = tablinks_dataset_2[i].className.replace(" active", "");
		  }

		  // Show the current tab, and add an "active" class to the button that opened the tab
		  document.getElementById(divName).style.display = "block";
		  evt.currentTarget.className += " active";
		}

		function openDataset(evt, divName) {
		  // Declare all variables
		  var i, tabcontent, tablinks;

		  // Get all elements with class="tabcontent" and hide them
		  tabcontent = document.getElementsByClassName("tabcontent_dataset");
		  for (i = 0; i < tabcontent.length; i++) {
		    tabcontent[i].style.display = "none";
		  }

		  // Get all elements with class="tablinks" and remove the class "active"
		  tablinks = document.getElementsByClassName("tablinks_dataset");
		  for (i = 0; i < tablinks.length; i++) {
		    tablinks[i].className = tablinks[i].className.replace(" active", "");
		  }

		  // Show the current tab, and add an "active" class to the button that opened the tab
		  document.getElementById(divName).style.display = "block";
		  evt.currentTarget.className += " active";
		}

	  	function deleteDataset(dataset){
			if (confirm("Delete dataset?")) {
				$.post($SCRIPT_ROOT + '/delete-dataset', {dataset_name : dataset}).done(
					function(result){
						if (result)
							openDatasets(null,0)//document.getElementById("dataset-"+dataset).remove()
					}

				);
			}
		}

		function submitFile(){
			var form_data = new FormData($('#upload-file')[0]);
	        $.ajax({
            type: 'POST',
            url: '/upload-file',
            data: form_data,
            contentType: false,
            cache: false,
            processData: false,
            success: function(data) {

					openDatasets (data["name"], 0);
					messagesLog("Upload Succeed")

				},
			error: function (xhr, status, error) {
          if (xhr.responseJSON == undefined){
              messagesLog("Upload Failed (Exceeded dataset size limit)")
          }
          else{
					     messagesLog("Upload Failed (" + xhr.responseJSON.message + ")")
					     openDatasets(null, 0)
          }
				}
			}
			);
	    }

  function submitQuery(){
    	var field = $( "#field_select option:selected" ).text();
    	var option = $( "#query_select" ).val();
    	var value = $( "#query_value").val()
    	openDatasets('{{data['collection']}}', 0, field, option, value )

  }

  function cleanQuery(){
  	openDatasets('{{data['collection']}}', 0)

  }


	if ('{{data["field"]}}' != "None") {

  	$( "#field_select" ).val('{{data["field"]}}');
  	$( "#query_select" ).val('{{data["option"]}}');
  	$( "#query_value").val('{{data["value"]}}')
  }


</script>



<div class="row" id="caixa" style="margin-left: 80px; z-index: 2; width: 100%; height: 100%;float: left; background-color: #F8F8F8; position: relative; top: 0%;" >

{% if data["dados"] == False %}

<div class="column" style="width: 20%; height: 100%">


	<div name="datasets" style="width: 100%; height: 100%">
		<div class="tab_datasets" style="font-size:10px; width: 100%; height: 7%; float: center">
		  <button class="tablinks_dataset active" onclick="openDataset(event, 'dataset')">Data Objects</button>
		  <!--<button class="tablinks_dataset" onclick="openDataset(event, 'files')">Files</button>-->
		</div>

		<div id="dataset" style = "width: 100%; display: block; font-size: 10px;" class="tabcontent_dataset" >

			<table class="datasets-table" style="width: 100%; float: left;">



			{% for value in data["datasets"] %}


			<tr id="dataset-{{value}}" style="width: 100%; ">

	            <!--<th colspan="2" style="width: 100%;">-->

  <!--
	            	<td style = "width: 100%;">
                  <a class="nav-link" href="#" style = "width: 70%; display: inline-block; text-align: center;" onclick="openDatasets('{{ value }}',0 )	">{{ value }}</a>
	          			<a href="#" onclick="deleteDataset('{{value}}')" style="width: 10%; display: inline-block; text-align: center; font-size: 21px;"> üóë </a>
	            	</td>

            -->
                <th colspan="2" style="width: 100%;">
                  <a class="nav-link" href="#" style = "width: 100%; text-align: center;" onclick="openDatasets('{{ value }}',0 )	">{{ value }}</a>

                <td colspan="2">
                  <a href="/download-dataset/{{value}}" style="width: 100%; font-size: 14px;" title = "Download {{value}} in CSV"> ‚¨áÔ∏è </a>
				</td>
				<td colspan="2">
					<a href="#" onclick="deleteDataset('{{value}}')" style="width: 100%; font-size: 21px;" title = "Delete {{value}} "> üóë </a>
				</td>
              </th>

	            <!--</th>-->

			</tr>

			{% endfor %}

			</table>

		</div>


		<div id="files" class="tabcontent_dataset">

			<table class="datasets-table" style="width: 100%; float: left;">
			{% for value in data["files"] %}

					<tr>
						<th> <a class="nav-link" href="#" onclick="openDatasets('{{ value }}', 0)">{{ value }}</a>  </th>
					</tr>

			{% endfor %}

			</table>


		</div>
	</div>
</div>

<div name="dashboard" style="width: 45.7%; height: 100%">
	<div class="tab_datasets" style="font-size:10px; height: 8%; float: center">
	  <button class="tablinks_dataset_2 active" onclick="openDivDashboard(event, 'upload')">Upload</button>
	</div>

	<div id="upload" class="tabcontent" style="display: block">

		<div id="bd_statistics" style="display: block">

			<table class="datasets-table" style="width: 100%; position:relative; font-size: 12px;">

				<tr class="header">
					<th> Database Storage Size </th>
					<td> {{data["db_size"]}} </td>
				</tr>

				<tr>
					<th> Number of Datasets </th>
					<td> {{data["datasets"]|length}}</td>
				</tr>
				<tr>
					<th> Average Size </th>
					<td> {{data["col_avg_size"]}}</td>
				</tr>

			</table>

		</div>

		<br>
		<br>

		<form id = "upload-file" action = "/upload-file" method = "POST" enctype = "multipart/form-data">


			<div class="input-group mb-3" style="width: 73.5%;">
			  <div class="input-group-prepend">
			    <span class="input-group-text" id="basic-addon1" style="font-size: 10px" >üìÅ</span>
			  </div>
			  <input type="text" class="form-control" style="font-size: 10px" placeholder="File or Collection Name" name ="collection_name"><label style="font-size: 10px"><input type="checkbox" name = "infer" value="" checked>Infer Types</label>
			</div>

			  <div class="upload-btn-wrapper">
			  <button class="btn_upload">Upload</button>
			  <input type="file" onchange="submitFile()//this.form.submit()" name="file" />
			</div>
		</form>


	</div>



</div>


{% endif %}


{% if data["dados"]%}

<div class="column" style="width: 20%; height: 100%">


	<div name="datasets" style="width: 100%; height: 100%">
		<div class="tab_datasets" style="font-size: 10px; width: 100%; height: 7%; float: center">
		  <button class="tablinks_dataset active" onclick="openDataset(event, 'dataset')">Data Objects</button>
		  <!--<button class="tablinks_dataset" onclick="openDataset(event, 'files')">Files</button>-->
		</div>

		<div id="dataset" style = "font-size: 10px; width: 100%; display: block" class="tabcontent_dataset" >

			<table class="datasets-table" style="width: 100%; float: left;">

			{% for value in data["datasets"] %}

			{% if value == data['collection'] %}
				<tr id="dataset-{{value}}" style="width: 100%;" class = "header">
			{% else %}
				<tr id="dataset-{{value}}" style="width: 100%;">
			{% endif %}



	            	<th colspan="2" style="width: 100%;">
	            		<a class="nav-link" href="#" style = "width: 100%; text-align: center;" onclick="openDatasets('{{ value }}',0 )">{{ value }}</a>

					<td colspan="2">
						<a href="/download-dataset/{{value}}" style="width: 100%; font-size: 14px;" title="Download {{value}} in CSV"> ‚¨áÔ∏è
						</a>
					</td>

	            	<td colspan="2">
	          			<a href="#" onclick="deleteDataset('{{value}}')" style="width: 100%; font-size: 21px;"> üóë </a>
	            	</td>
	            </th>

			</tr>

			{% endfor %}

			</table>

		</div>

		<div id="files" class="tabcontent_dataset">

			<table class="datasets-table" style="width: 100%; float: left;">

			{% for value in data["files"] %}

					<tr>
						<th> <a class="nav-link" href="#" onclick="openDatasets('{{ value }}', 0)">{{ value }}</a>  </th>
					</tr>

			{% endfor %}

			</table>


		</div>
	</div>


</div>


<script type="text/javascript">

	String.prototype.replaceAt=function(index, replacement) {
	    return this.substr(0, index) + replacement;
	}

	function page(element, nbPage){
	    $(element).attr('href', function() {
	    	url = this.href
	    	return this.href.replace("#", "").replaceAt(url.indexOf("&page=") + 6, nbPage) //+ nbPage;
	    });
	}

	function nextPage(element){
	    $(element).attr('href', function() {
	    	/*url = this.href
	    	nbPage = {{ data["page"] }} + 1

	    	if ( nbPage < {{data["total_pages"]}} ) {
	    		if (url.indexOf("&page") != -1)
		    		return this.href.replace("#", "").replaceAt(url.indexOf("&page=") + 6, nbPage) //+ nbPage;
		    	else
		    		return this.href.replace("#", "") + "&page=" + nbPage
		    }
		    return this.href */
		    openDatasets('{{data['collection']}}', datasetPage + 1)
	    });
	}

	function previousPage(element){
	    $(element).attr('href', function() {
	    	url = this.href
	    	nbPage = {{ data["page"] }} - 1

	    	if ( nbPage >= 0 ) {
		    	if (url.indexOf("&page") != -1)
		    		return this.href.replace("#", "").replaceAt(url.indexOf("&page=") + 6, nbPage) //+ nbPage;
		    	else
		    		return this.href.replace("#", "") + "&page=" + nbPage
		    }
		    return this.href
	    });
	}

</script>


<div class="column" style="width: 55% ">
	<div class="pagination">

		<a href="#" onclick="openDatasets('{{data['collection']}}', {{data['page'] - 1}} )">&laquo;</a>

		{% set page = data["page"] %}
		{% set central_page = 7 %}
		{% if page < 12 %}
		{% set maxPage = 15 %}
		{% elif page >= 12 and page < 17%}
		{% set maxPage = 14 %}
		{% elif page >= 17 and page < 23%}
		{% set maxPage = 13 %}
		{% elif page > 22 and page < 99%}
		{% set maxPage = 13 %}
		{% elif page >= 99 and page < 1000%}
		{% set maxPage = 11 %}
		{% set central_page = 6 %}
		{% elif page >= 1000 %}
		{% set maxPage = 10 %}
		{% set central_page = 5 %}
		{% endif %}

		{% for i in range([page+central_page-maxPage, 0]|max, [[maxPage, page + central_page]|max, data["total_pages"]]|min ) %}
			{% if i == data["page"] %}
				<a class = "active" href="#" onclick="openDatasets('{{data['collection']}}', {{i}})">{{i}}</a>
			{% else %}
				<a href="#" onclick="openDatasets('{{data['collection']}}', {{i}}, '{{data['field']}}', '{{ data['option'] }}', '{{ data['value'] }}')">{{i}}</a>
			{% endif %}


		{% endfor %}

		<a href="#" onclick="openDatasets('{{data['collection']}}', {{data['page'] + 1}} )">&raquo;</a>
	</div>



	<div style="height: calc(100% - 10%); width: 80%;">

		<form id = "query_form" method = "POST" enctype = "multipart/form-data" style = "font-size: 12px;">

			<tr>
				<th>
					<label> Attribute</label>
				</th>

				<td>

					<select id = "field_select" class = "select-css" name = "field_select">
						{% for element in data["fields"] %}
							<option value = "{{element}}">{{element}}</option>
						{% endfor %}
			       </select>

				</td>

				<td>

					<select id = "query_select" class = "select-css" style = "width: 10%;" name = "query_select">
						<option value = "equals"> = </option>
						<option value = "not_equals"> != </option>
						<option value = "greater"> > </option>
						<option value = "greater_equal"> >= </option>
						<option value = "less"> < </option>
						<option value = "less_equal"> <= </option>
			       </select>

				</td>

				<th>
					<input type="text" value="" id = "query_value">

				</th>

				<td>
					<a href = "#" onclick="submitQuery()">

						<label> Submit</label>

					</a>
				<td>
				<td>
					<a href = "#" onclick="cleanQuery()">

						X

					</a>
				<td>


			</tr>

		</form>

		<table class="datasets-table" style="height: calc(100% - 11%); width: 55%; position:absolute; font-size:10px;">

		{% if data["stream"] == [] %}

			<script>
				alert("Query Didn't Return Any Data")
				openDatasets(null, 0)
			</script>

		{% endif %}
		{% for element in data["stream"] %}
			{% for dataObject in element %}
				{% if dataObject == "_id" %}
					<tr class = "header">
				{% else %}
					<tr>
				{% endif %}

						<th style = "width: 3%"> {{ dataObject }} </th>
						<td style = "width: 10%">  {{ element[dataObject] }} </td>


					</tr>

			{% endfor %}

		{% endfor %}
		</table>
	</div>

</div>

<div name="dashboard" style="width: 25%; height: 100%">
	<div class="tab_datasets" style="font-size: 10px; height: 8%; float: center">
	  <button class="tablinks_dataset_2 active" onclick="openDivDashboard(event, 'statistics')">Statistics</button>
	  <button class="tablinks_dataset_2" onclick="openDivDashboard(event, 'upload')">Upload</button>
	</div>

	<div id="statistics" class="tabcontent" style="display: block; font-size: 10px;">

		<table class="datasets-table" style="height: calc(22%); width: 100%; position:relative; ">
			<tr class="header">
				<th> Number of Data Objects </th>
				<td> {{ data["stream_size"] }} </td>

			</tr>
			<tr>
				<th> Dataset Size </th>
				<td> {{ data["storage_size"] }} </td>
			</tr>

			<tr>
				<th> Database Storage Size </th>
				<td> {{data["db_size"]}} </td>
			</tr>

			<tr>
				<th> Number of Datasets </th>
				<td> {{data["datasets"]|length}}</td>
			</tr>
			<tr>
				<th> Average Size </th>
				<td> {{data["col_avg_size"]}}</td>
			</tr>

		</table>

		<table class="datasets-table" style="width: 100%; position:relative; ">
			<tr class="header">
				<th> Attribute </th>
				<td> Type </td>
			</tr>

			{% for element in data["types"] %}
				<tr>
					<th> {{element["field"]}} </th>
					<td> {{element["type"]}} </td>

				</tr>
			{% endfor %}

		</table>



	</div>

	<div id="upload" class="tabcontent">

	<form id = "upload-file" action = "/upload-file" method = "POST" enctype = "multipart/form-data" style = "font-size: 12px;">
      <div class="input-group mb-3" style="width: 73.5%;">
        <div class="input-group-prepend">
          <span class="input-group-text" id="basic-addon1" style="font-size: 10px" >üìÅ</span>
        </div>
        <input type="text" class="form-control" style="font-size: 10px" placeholder="File or Collection Name" name ="collection_name">
	  </div>


      <div>
        <label style="left: 0px; font-size: 10px"> <input type="checkbox" name = "infer" value="" checked>Infer Types</label>
	  </div>


			  <div class="upload-btn-wrapper">
			  <button class="btn_upload">Upload</button>
			  <input type="file" onchange="submitFile()//this.form.submit()" name="file" />
			</div>
		</form>

	</div>

</div>

<!--<div style="position:absolute; top:0; right:7px; font-size: 14px; cursor: pointer;" href="javascript.void(0)" onclick="closeDatasets()">‚ùå</div>-->

</div>

{% endif %}

<!--</table>

<div style="position:absolute; top:0; right:7px; font-size: 14px; cursor: pointer;" href="javascript.void(0)" onclick="closeDatasets()">‚ùå</div>

</div>
-->


</div>
</div>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Modal Header</h4>
      </div>
      <div class="modal-body">
        <p>Some text in the modal.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
